<?xml version="1.0"?>

<f:view xmlns="http://www.w3.org/1999/xhtml"
        xmlns:f="http://java.sun.com/jsf/core"
        xmlns:h="http://java.sun.com/jsf/html"
        xmlns:p="http://primefaces.org/ui"
        xmlns:ui="http://java.sun.com/jsf/facelets"
        xmlns:c="http://java.sun.com/jsp/jstl/core">
	<h:head>
		  <meta charset="utf-8" />
		  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
		  <title>ERP Dashboard</title>
		  <f:metadata>
			    <f:viewAction action="#{dashboardNewAction.onload}" />
			    <f:viewAction action="#{showAction.onload}" />
			</f:metadata>
		  <!-- Tell the browser to be responsive to screen width -->
		  <meta content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" name="viewport" />
		  <link rel="stylesheet" href="../AdminLTE-2.4.3/bower_components/bootstrap/dist/css/bootstrap.min.css" />
		  <link rel="stylesheet" href="../AdminLTE-2.4.3/bower_components/font-awesome/css/font-awesome.min.css" />
		  <link rel="stylesheet" href="../AdminLTE-2.4.3/bower_components/Ionicons/css/ionicons.min.css" />
		  <link rel="stylesheet" href="../AdminLTE-2.4.3/bower_components/jvectormap/jquery-jvectormap.css" />
		  <link rel="stylesheet" href="../AdminLTE-2.4.3/dist/css/AdminLTE.min.css" />
		  <link rel="stylesheet" href="../AdminLTE-2.4.3/dist/css/skins/_all-skins.min.css" />
		   <link href="https://cdn.datatables.net/1.10.16/css/jquery.dataTables.min.css" rel="stylesheet" />
			<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.6.4/css/bootstrap-datepicker.css"></link>
		   
		   <style>
				.chartdiv {
				  width: 100%;
				  height: 400px;
				}
				
				.amcharts-chart-div a {
					display :none !important;
				}
				
				.text-table-body {
				    font-weight: normal;
				    font-size: 12px;
				}
				
				.ui-column-title {
				    font-size: 12px;
				}
				
				.ui-dialog {
					position:absolute;
				}
			</style>
			
			<script>
				function showModal() {
					$("#myModal").modal();
				}
				
				function closeModal(){
					PF('dlg').hide();
				}
			</script>
	</h:head>
    <h:body styleClass="skin-blue sidebar-mini sidebar-collapse">
    	<h:form id="formId" class="form-horizontal">
			<div class="wrapper">
			  <header class="main-header">
			    <!-- Logo -->
			    <a href="index2.html" class="logo" style="background-color:#f37020">
			      <!-- mini logo for sidebar mini 50x50 pixels -->
			      <span class="logo-mini">ERP</span>
			      <!-- logo for regular state and mobile devices -->
			      <span class="logo-lg"><b>ERP</b></span>
			    </a>
			
			    <!-- Header Navbar: style can be found in header.less -->
			    <nav class="navbar navbar-static-top" style="background-color:#f37020">
			      <!-- Sidebar toggle button-->
			      <a href="#" class="sidebar-toggle" data-toggle="push-menu" role="button">
			        <span class="sr-only">Toggle navigation</span>
			      </a>
			      <!-- Navbar Right Menu -->
			      <div class="navbar-custom-menu">
			        <ul class="nav navbar-nav">
			         
			          <!-- User Account: style can be found in dropdown.less -->
			          <li class="dropdown user user-menu">
			            <ul class="dropdown-menu">
			              <li class="user-footer">
			                <div class="pull-left">
			                  <a href="#" class="btn btn-default btn-flat">Profile</a>
			                </div>
			                <div class="pull-right">
			                  <a href="#" class="btn btn-default btn-flat">Sign out</a>
			                </div>
			              </li>
			            </ul>
			          </li>
			          <!-- Control Sidebar Toggle Button -->
			          <li>
			            <h:commandLink styleClass="nav-link" value="Logout"
			       			action="#{dashboardNewAction.onLogout}">
			       			<i class="fa fa-fw fa-sign-out"></i>
			       		</h:commandLink>
			          </li>
			        </ul>
			      </div>
			
			    </nav>
			  </header>
			  <!-- Left side column. contains the logo and sidebar -->
			  <aside class="main-sidebar">
			    <!-- sidebar: style can be found in sidebar.less -->
			    <section class="sidebar">
			      
			      <!-- sidebar menu: : style can be found in sidebar.less -->
			      <ul class="sidebar-menu" data-widget="tree">
			    
			        <li class="active treeview menu-open">
			          <a href="#">
			            <i class="fa fa-dashboard"></i> <span>Dashboard</span>
			            <span class="pull-right-container">
			              <i class="fa fa-angle-left pull-right"></i>
			            </span>
			          </a>
			          <ul class="treeview-menu">
			            <li class="active"><a href="index2.html"><i class="fa fa-circle-o"></i> Dashboard</a></li>
			          </ul>
			        </li>
			      </ul>
			    </section>
			    <!-- /.sidebar -->
			  </aside>
			
			  <!-- Content Wrapper. Contains page content -->
			  <div class="content-wrapper">
			    <!-- Content Header (Page header) -->
			    <section class="content-header">
			    	<p:messages id="messages" showDetail="true" closable="true">
		   		 </p:messages>
			      <h1>
			        Dashboard
			      </h1>
			    </section>
			
			    <!-- Main content -->
			    <section class="content">
			
			      <div class="row">
			       <div class="col-md-12">
			        <div class="box box-success">
			            <div class="box-header with-border">
			              <!-- <h3 class="box-title">ERP Dashboard</h3> -->
			
			              <div class="box-tools pull-right">
			                <button type="button" class="btn btn-box-tool" data-widget="collapse"><i class="fa fa-minus"></i>
			                </button>
			              </div>
			             
			            </div>
			            <div class="box-body" style="">
			             	<div class="row">
			             		<div class="col-sm-12" >
			             			<h:outputLabel value="Receipt Date : " style="padding-right: 10px;"></h:outputLabel>
			             			<p:calendar value="#{dashboardNewAction.date}" pattern="dd/MM/yyyy" style="padding-right: 10px;" mask="true" >
			             			</p:calendar>
			             			<p:commandButton value="Search" update="canvasGroup, canvasGroupJs, canvasGroupPSJs" actionListener="#{dashboardNewAction.updateReceiptTempChart}" />
			             		</div>
				           		<div class="col-sm-12 text-center">
				           			<h:panelGroup id="canvasGroup">
										<div id="chartdiv1" class="chartdiv"></div>             
									</h:panelGroup>
				           			<h:panelGroup id="canvasGroupPS">
										<div id="chartdiv2" class="chartdiv" ></div>  
									</h:panelGroup>
				           		</div>
				           	</div>
			            </div>
			          </div>
			       </div>
			      </div>
			    </section>
			  </div>
			</div>
			
		   <div class="modal fade" id="myModal" role="dialog">
		    <div class="modal-dialog modal-lg " style="width: 100%; max-width: 1170px;">
		      <!-- Modal content-->
		      <div class="modal-content">
		        <div class="modal-body">
		        	<h:panelGroup id="tb_revenue">
		          		<table id="example" class="display" style="width:100%">
			    			<thead>
						        <tr>
						            <th>ERP ID</th>
						            <th>Branch</th>
						            <th>Receipt Date</th>
						            <th>Amount Header</th>
						            <th>Cash</th>
						            <th>Rabbit</th>
						            <th>Card (BBL)</th>
						            <th>Card (SCB)</th>
						            <th>LinePay</th>
						            <th>Bonus Commission</th>
						            <th>AdjOther</th>
						            <th>Return Charge</th>
						            <th>Suspense</th>
						            <th>With Holding Tax</th>
						            <th>Promotion</th>
						            <th>Insurance</th>
						            <th>Status</th>
						        </tr>
						    </thead>
						    <tbody>
						    	<c:forEach var="receipt" items="#{dashboardNewAction.copReceiptTemps}">
							        <tr>
							            <td>#{receipt.shopCode}</td>
							            <td>#{receipt.shopName}</td>
							            <td>
							            	<p:calendar value="#{receipt.arReceiptDate}" style="width: 150px;"></p:calendar>
										</td>
							            <td>#{receipt.amountHeader}</td>
							            <td>#{receipt.cash}</td>
							            <td>#{receipt.rabit}</td>
							            <td>#{receipt.creditBBL}</td>
							            <td>#{receipt.creditSCB}</td>
							            <td>#{receipt.linePay}</td>
							            <td>#{receipt.bonus}</td>
							            <td>#{receipt.adjOther}</td>
							            <td>#{receipt.adjReturnCharge}</td>
							            <td>#{receipt.suspense}</td>
							            <td>#{receipt.withholdingTax}</td>
							            <td>#{receipt.promotion}</td>
							            <td>#{receipt.insurance}</td>
							            <td>
							            	<h:panelGroup rendered="#{receipt.status == null || receipt.status == ''}">
									            <select >
													  <option value="">Active</option>
													  <option value="N">Inactive</option>
												</select>
											</h:panelGroup>
								            <h:outputLabel styleClass="text-table-body" value="Inactive" rendered="#{not (receipt.status == null || receipt.status == '')}">
								            </h:outputLabel>
										</td>
							        </tr>
						        </c:forEach>
						    </tbody>
			    		</table>
		          	</h:panelGroup>
		        </div>
		        <div class="modal-footer">
		          <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
		        </div>
		      </div>
		    </div>
		  </div>
			
			<h:inputHidden id="x" value="#{dashboardNewAction.param}" />
			<p:remoteCommand name="selectItemFromChart" update="tb_revenue, revenueJs"
				 action="#{dashboardNewAction.updateRevenues}"
				 oncomplete="showModal()" >
		  	</p:remoteCommand>
		  	<p:remoteCommand name="selectItemFromChartPS" update="canvasGroupPS canvasGroupPSJs"
				 action="#{dashboardNewAction.updateChartPS}" >
		  	</p:remoteCommand>
		</h:form>
		
		<script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.6.4/js/bootstrap-datepicker.js"></script>
		<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.5.0/Chart.min.js"></script>
		<script src="//cdn.datatables.net/1.10.16/js/jquery.dataTables.min.js"></script>
		<script src="https://www.amcharts.com/lib/3/amcharts.js"></script>
		<script src="https://www.amcharts.com/lib/3/pie.js"></script>
		<script src="https://www.amcharts.com/lib/3/plugins/export/export.min.js"></script>
		<link rel="stylesheet" href="https://www.amcharts.com/lib/3/plugins/export/export.css" type="text/css" media="all" />
		<script src="https://www.amcharts.com/lib/3/themes/light.js"></script>
		<script src="../AdminLTE-2.4.3/bower_components/bootstrap/dist/js/bootstrap.min.js"></script>
		<script src="../AdminLTE-2.4.3/bower_components/fastclick/lib/fastclick.js"></script>
		<script src="../AdminLTE-2.4.3/dist/js/adminlte.min.js"></script>
		<script src="../AdminLTE-2.4.3/bower_components/jquery-sparkline/dist/jquery.sparkline.min.js"></script>
		<script src="../AdminLTE-2.4.3/bower_components/jquery-slimscroll/jquery.slimscroll.min.js"></script>
		<script src="../AdminLTE-2.4.3/dist/js/demo.js"></script>
		
		<!-- Chart code -->
		<h:panelGroup id="canvasGroupJs">
			<h:outputScript>
	    		AmCharts.makeChart("chartdiv1", {
	    		  "type": "pie",
				  "theme": "light",
				  "dataProvider": #{dashboardNewAction.datas},
				  "valueField": "count",
				  "titleField": "branchType",
				  "pullOutDuration": 0,
  				   "pullOutRadius": 0,
				   "balloon":{
				   "fixedPosition":true
				  },
				  "balloonText": "[[branchType]] <br /> Total Shop : [[count]] <br /> Total Amount : [[amountHeader]]",
				  "export": {
				    "enabled": false
				  },
				  "listeners": [{
					    "event": "clickSlice",
					    "method": function(e) {
						    	if(e.dataItem.title == 'BSD'
						          		|| e.dataItem.title == 'DC'
						          		|| e.dataItem.title == 'UPC'){
							          	document.getElementById("formId:x").value = e.dataItem.title;
							      		selectItemFromChart({param:e.dataItem.title});
						          	}else{
						          		selectItemFromChartPS({param:e.dataItem.title});
						          	}
					    }}]
				} );
			</h:outputScript>
		</h:panelGroup>
		<h:panelGroup id="canvasGroupPSJs">
			<h:outputScript>
				AmCharts.makeChart("chartdiv2", {
	    		  "type": "pie",
				  "theme": "light",
				  "dataProvider": #{dashboardNewAction.chartPS},
				  "valueField": "count",
				  "titleField": "branchType",
				  "pullOutDuration": 0,
  				   "pullOutRadius": 0,
				   "balloon":{
				   "fixedPosition":true
				  },
				  "balloonText": "[[branchType]] <br /> Total Shop : [[count]] <br /> Total Amount : [[amountHeader]]",
				  "export": {
				    "enabled": false
				  },
				  "listeners": [{
					    "event": "clickSlice",
					    "method": function(e) {
						    	document.getElementById("formId:x").value = e.dataItem.title;
							    selectItemFromChart({param:e.dataItem.title});
					    }}]
				} );
			</h:outputScript>
		</h:panelGroup>
		<h:panelGroup id="revenueJs">
			<h:outputScript>
				var table = $('#example').DataTable({
				  "scrollX": true
				});
			</h:outputScript>
		</h:panelGroup> 
    </h:body>
</f:view>
