<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:p="http://primefaces.org/ui"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:c="http://java.sun.com/jsp/jstl/core">
<h:head>
	<meta charset="utf-8" />
	<title>ERP Dashboard</title>
	<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
	<meta content="kvthemes" name="author" />
	<meta http-equiv="X-UA-Compatible" content="IE=edge" />
	<f:metadata>
		<f:viewAction action="#{copDashboardController.onload}" />
	</f:metadata>
	<link href="../assets/css/bootstrap.min.css" rel="stylesheet" type="text/css" />
	<link href="../assets/css/style.css" rel="stylesheet" type="text/css" />
	<link href="../assets/css/responsive.css" rel="stylesheet" type="text/css" />
	<link href="../assets/css/icons.css" rel="stylesheet" type="text/css" />
	<script src="../assets/js/modernizr.min.js"></script>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<link href="https://vitalets.github.io/bootstrap-datepicker/bootstrap-datepicker/css/datepicker.css" rel="stylesheet" />
	<link href="../css/datepicker.css" rel="stylesheet" />
	<link rel="stylesheet" href="../css/erp.css" />
	<link href="../css/jquery.dataTables.min.css" rel="stylesheet" />
	<link href="../css/bootstrap-toggle.min.css" rel="stylesheet" />
</h:head>
<h:body class="fixed-left">
	<div id="wrapper" class="collapse-menu forced">
		<header class="topbar">
			<div class="topbar-left">
				<div class="left-content text-center">
					<a href="cop_dashboard.jsf" class="logo">ERP</a>
				</div>
			</div>

			<div class="navbar navbar-default" role="navigation">
				<div class="container">
					<div class="mobile-button pull-left">
						<button type="button" class="button-menu-mobile open-left">
							<i class="icon-menu"></i>
						</button>
						<span class="clearfix"></span>
					</div>

					<div class="zoom-out-button pull-left">
						<a href="javascript:void();" id="btn-fullscreen"
							class="waves-effect fullscreen-button"><i class="icon-frame"></i></a>
						<span class="clearfix"></span>
					</div>

					<ul class="nav navbar-nav navbar-right pull-right">
						<li class="dropdown"><a href="javascript:void();"
							class="dropdown-toggle profile" data-toggle="dropdown"
							aria-expanded="true"><img
								src="../images/gear-settings.png" alt="user-img"
								class="img-circle" /> </a>
							<ul class="dropdown-menu">
								<h:form>
									<li class="dropdown-user" style="padding-left: 10px;padding-bottom: 5px;padding-top: 5px;">
                                          <div class="media-heading"><h5>User Name : #{copDashboardController.userLogin.userName}</h5></div>
                                    </li>
									<li class="divider"></li>
									<li style="padding-left: 10px;">
							            <h:commandLink
							       			action="#{dashboardController.onLogout}">
							       			<i class="icon-power"></i>
							       			<h:outputLabel value="Logout" style="padding-left: 5px;"></h:outputLabel>
							       		</h:commandLink>
							          </li>
								</h:form>
							</ul></li>
					</ul>
				</div>
			</div>
		</header>
		<h:form>
			<div class="left side-menu">
				<div class="sidebar-inner slimscrollleft">
					<!--- Divider -->
					<div id="sidebar-menu">
						<ul>
							<li class="child-menu">
								<a href="cop_dashboard.jsf"
									class="waves-effect"><i class="icon-home"></i><span>Dashboard
									</span> <span class="pull-right"><i class="icon-arrow-right"></i></span>
								</a>
								
								<ul class="list-unstyled">
									<li>
										<h:commandLink 
											action="#{dashboardController.onPageCopDashboard}">
											<i class="fa fa-hand-o-right"></i>
											<h:outputLabel value="COP Dashboard" style="padding-left: 5px;"></h:outputLabel>
										</h:commandLink>
									</li>
								</ul>
							</li>
						</ul>
						<div class="clearfix"></div>
					</div>
					<div class="clearfix"></div>
				</div>
			</div>
		</h:form>
		<div class="content-page">
			<div class="content">
				<div class="container">
					<h:form id="formId">
						<div class="row">
							<p:messages id="messages" showDetail="true" autoUpdate="true" closable="true">
		   		 			</p:messages>
						</div>
						<div class="row">
							<div class="col-sm-4">
								<div class="panel panel-default">
									<div class="panel-body">
										<div class="row">
											<div class="col-sm-5" style="text-align: right;">
												<h4>
													<i class="icon-calendar"></i> Receipt Date
												</h4>
											</div>
											<div class="col-sm-7">
												<h:inputText id="dateStrId" value="#{copDashboardController.dateStr}"
													styleClass="form-control datepicker"></h:inputText>
											</div>
										</div>
									</div>
								</div>
							</div>

							<!--Button View-->
							<div class="col-lg-2 col-sm-6 col-xs-12">
								<div class="card p-20 bg-rose">
									<div class="media">
										<div class="media-body">
											<div class="col-sm-6 text-left">
												<p:commandLink update="canvasGroup, canvasGroupJs, canvasGroupPSJs" 
								             			actionListener="#{copDashboardController.updateReceiptTempChart}"
								             			oncomplete="clearDivChart()">
												    <h:graphicImage value="../images/pie-chart-stats.png" />
												</p:commandLink>
											</div>
											<div class="col-sm-6 text-right">
												<p:commandLink update="canvasGroup, canvasGroupJs, canvasGroupPSJs" 
								             			actionListener="#{copDashboardController.updateReceiptTempChart}"
								             			oncomplete="clearDivChart()">
												    <h4 class="text-white">View Report</h4>
												</p:commandLink>
											</div>
										</div>
									</div>
								</div>
							</div>
							<div class="col-lg-2 col-sm-6 col-xs-12">
								<div class="card p-20 bg-blue">
									<div class="media">
										<div class="col-sm-5 text-left">
												<p:commandLink actionListener="#{copDashboardController.showPDF}"
					  								update="pdfId" oncomplete="showModalPDF()">
												    <h:graphicImage value="../images/book-opened-symmetrical-shape.png" />
												</p:commandLink>
											</div>
											<div class="col-sm-6 text-right">
												<p:commandLink actionListener="#{copDashboardController.showPDF}"
					  								update="pdfId" oncomplete="showModalPDF()">
												    <h6 class="text-white">View Accounting Temp</h6>
												</p:commandLink>
											</div>
									</div>
								</div>
							</div>
							<div class="col-lg-2 col-sm-6 col-xs-12">
								<div class="card p-20 bg-blue"  >
									<div class="media">
										<div class="col-sm-5 text-left">
												<p:commandLink ajax="false" 
														onclick="PrimeFaces.monitorDownload(start, stop);" icon="ui-icon-arrowthick-1-s">
												    <h:graphicImage value="../images/book-opened-symmetrical-shape.png" />
											        <p:fileDownload value="#{copDashboardController.showExcelGL}" />
											    </p:commandLink>
											</div>
											<div class="col-sm-7 text-right">
												<p:commandLink ajax="false" 
														onclick="PrimeFaces.monitorDownload(start, stop);" icon="ui-icon-arrowthick-1-s">
												    <h6 class="text-white">View Accounting GL</h6>
											        <p:fileDownload value="#{copDashboardController.showExcelGL}" />
											    </p:commandLink>
											</div>
									</div>
								</div>
							</div>
						</div>
						<br />
						<div class="row">
							<div class="col-lg-12">
								<div class="panel panel-primary">
									<div class="panel-heading">
										<i class="fa fa-bar-chart-o fa-fw"></i>Graphs
									</div>
									<div class="panel-body">
										<div class="panel panel-default">
											<div class="panel-body">
												<div class="row">
													<div class="col-12" style="text-align: right">
														<p:commandButton ajax="false" value="Export All" styleClass="btn btn-info"
																onclick="PrimeFaces.monitorDownload(start, stop);" icon="ui-icon-arrowthick-1-s">
													        <p:fileDownload value="#{copDashboardController.showAllTransactionExcel}" />
													    </p:commandButton>
													</div>
												</div>
												<div class="row">
													<div class="col-sm-11 text-center" id="divChart1">
														<h:panelGroup id="canvasGroup">
															<div id="chartdiv1" onclick="divChartClick()" class="chartdiv"></div>
														</h:panelGroup>
													</div>
													<div class="col-sm-1 text-center" id="divChart2">
														<h:panelGroup id="canvasGroupPS">
															<div id="chartdiv2" onclick="divChartClick()" class="chartdiv"></div>
														</h:panelGroup>
													</div>
												</div>
											</div>
										</div>
									</div>
								</div>
							</div>
						</div>

						<div class="modal fade" id="myModal" role="dialog">
							<div class="modal-dialog modal-lg "
								style="width: 100%; max-width: 1170px;">
								<div class="modal-content">
									<div class="modal-body">
										<h:panelGroup id="tb_revenue">
											<table id="example" class="display" style="width: 100%;">
												<thead>
													<tr>
														<th>ERP ID</th>
														<th>Branch</th>
														<th>Receipt Date</th>
														<th>GL Date</th>
														<th>Cash</th>
														<th>Freight</th>
														<th>COD</th>
														<th>Package+Sale Package</th>
														<th>Line Pay</th>
														<th>Card (BBL)</th>
														<th>Card (SCB)</th>
														<th>Rabbit</th>
														<th>Topup</th>
														<th>Discount</th>
														<th>Insurance</th>
														<th>Bonus Commission</th>
														<th>AdjOther</th>
														<th>Return Charge</th>
														<th>Suspense</th>
														<th>Withholding Tax</th>
														<th>Promotion</th>
														<th>Bank Charge</th>
														<th>Credit Card</th>
														<th>Adj Line Pay</th>
														<th>VAT</th>
														<th>Status</th>
													</tr>
												</thead>
												<tbody>
													<c:forEach var="receipt"
														items="#{copDashboardController.copReceiptTemps}">
														<tr>

															<td>#{receipt.shopCode}</td>
															<td>#{receipt.shopName}</td>
															<td><h:inputText value="#{receipt.arReceiptDateStr}"
																	styleClass="form-control datepicker dateintable datepicker-inmodel"></h:inputText>
															</td>
															<td>#{receipt.arGlDateStr}</td>
															<td>#{receipt.cash}</td>
															<td>#{receipt.freight}</td>
															<td>#{receipt.cod}</td>
															<td>#{receipt.packageSalePackage}</td>
															<td>#{receipt.linePay}</td>
															<td>#{receipt.creditBBL}</td>
															<td>#{receipt.creditSCB}</td>
															<td>#{receipt.rabit}</td>
															<td>#{receipt.topup}</td>
															<td>#{receipt.discount}</td>
															<td>#{receipt.insurance}</td>
															<td>#{receipt.bonus}</td>
															<td>#{receipt.adjOther}</td>
															<td>#{receipt.adjReturnCharge}</td>
															<td>#{receipt.suspense}</td>
															<td>#{receipt.withholdingTax}</td>
															<td>#{receipt.promotion}</td>
															<td>#{receipt.bankCharge}</td>
															<td>#{receipt.creditCard}</td>
															<td>#{receipt.adjLinePay}</td>
															<td>#{receipt.vat}</td>
															<td><input class="toggle-demo toggle-w" type="checkbox"
																checked="#{receipt.status == 'N' ? '' : 'check'}"
																disabled="#{receipt.status == 'N' ? 'disabled' : ''}"
																data-toggle="toggle"
																data-width="20px"
																onchange="statusChange(this, #{receipt.rownum})"  /></td>
														</tr>
													</c:forEach>
												</tbody>
											</table>
										</h:panelGroup>
									</div>
									<div class="modal-footer">
										<button type="button" class="btn btn-primary"
											onclick="saveReceiptTempJs()">Save</button>

										<h:commandButton value="export excel"
											styleClass="btn btn-info"
											action="#{copDashboardController.exportTransactionExcel}" />

										<button type="button" class="btn btn-default"
											data-dismiss="modal">Close</button>
									</div>
								</div>
							</div>
						</div>

						<div class="modal fade" id="myModalPDF" role="dialog">
							<div class="modal-dialog modal-lg "
								style="width: 100%; max-width: 1170px;">

								<!-- Modal content-->
								<div class="modal-content">
									<div class="modal-body modal-body-pdf">
										<h:panelGroup id="pdfId">
											<p:media value="#{copDashboardController.streamedContent}"
												player="pdf" width="100%" height="550px">
											</p:media>
										</h:panelGroup>
									</div>
									<div class="modal-footer modal-footer-pdf">
										<h:commandButton value="export excel"
											styleClass="btn btn-info"
											action="#{copDashboardController.exportExcel}" />
									</div>
								</div>

							</div>
						</div>
						
						<div class="modal fade modalLoading" role="dialog">
							<div class="modal-dialog">
								<div class="modal-content">
									<div class="modal-body">
										<img src="../images/45.gif" />
									</div>
								</div>
							</div>
						</div>
						
						<p:dialog widgetVar="statusDialog" 
							modal="true" draggable="false" 
							closable="false" resizable="false" 
							showHeader="false"
							styleClass="loadingerp">
							<div class="row" style="width: 100%;height: 100%">
								<div class="col-sm-4" style="text-align: right;">
									<img src="../images/45.gif" />
								</div>
								<div class="col-sm-8" style="text-align: left;vertical-align: middle;">
						    		<h4 >Loading...</h4>
						    	</div>
							</div>
						</p:dialog>

						<h:inputHidden id="x" value="#{copDashboardController.param}" />
						<h:inputHidden id="y" value="#{copDashboardController.param2}" />
						<p:remoteCommand name="saveReceiptTempJs"
							update="canvasGroup , canvasGroupJs , canvasGroupPSJs"
							action="#{copDashboardController.saveReceiptTemp}"
							oncomplete="closeModal()"></p:remoteCommand>
						<p:remoteCommand name="selectItemFromChart"
							update="tb_revenue , tb_revenueJS"
							action="#{copDashboardController.updateReceiptTemp}"
							oncomplete="showModal()"></p:remoteCommand>
						<p:remoteCommand name="tableNextPage" update="datepickerJs"></p:remoteCommand>
						<p:remoteCommand name="selectItemFromChartPS"
							update="canvasGroupPS , canvasGroupPSJs"
							action="#{copDashboardController.updateChartPS}"></p:remoteCommand>
						<p:remoteCommand name="updateStatus"
							action="#{copDashboardController.updateStatus}"></p:remoteCommand>
							
						<p:ajaxStatus onstart="PF('statusDialog').show()" onsuccess="PF('statusDialog').hide()" />
					</h:form>
				</div>
			</div>

			<footer class="footer text-right">
			
			</footer>
		</div>
	</div>
	<script>
		var resizefunc = [];
	</script>

	<script src="../assets/js/jquery.min.js"></script>
	<script src="../assets/js/bootstrap.min.js"></script>
	<script src="../assets/js/detect.js"></script>
	<script src="../assets/js/fastclick.js"></script>
	<script src="../assets/js/jquery.slimscroll.js"></script>
	<script src="../assets/js/jquery.blockUI.js"></script>
	<script src="../assets/js/waves.js"></script>
	<script src="../assets/js/jquery.nicescroll.js"></script>
	<script src="../assets/js/jquery.scrollTo.min.js"></script>
	<script src="../assets/js/jquery.app.js"></script>
	<script src="../js/jquery.cookie.js"></script>
	<script src="../js/bootstrap-datepicker.js"></script>
	<script src="../js/amcharts.js"></script>
	<script src="../js/pie.js"></script>
	<script src="../js/light.js"></script>
	<script src="../js/bootstrap-toggle.min.js"></script>
	<script src="../js/jquery.dataTables.min.js"></script>
	<script type="text/javascript" src="../js/erp.js"></script>

	<h:panelGroup id="canvasGroupJs">
		<h:outputScript>
	    		AmCharts.makeChart("chartdiv1", {
	    		  "type": "pie",
				  "theme": "light",
				  "dataProvider": #{copDashboardController.datas},
				  "labelText": "[[branchType]]",
				  "valueField": "count",
				  "titleField": "branchType",
				  "pullOutDuration": 0,
  				   "pullOutRadius": 0,
				   "balloon":{
				   "fixedPosition":true
				  },
				  "balloonText": "[[branchType]] <br /> Total Shop : [[count]] <br /> Total Amount : [[amountHeader]]",
				  "export": {
				    "enabled": false
				  },
				  "listeners": [{
					    "event": "clickSlice",
					    "method": function(e) {
					    		document.getElementById("formId:x").value = e.dataItem.title;
					    		
						    	if(e.dataItem.title == 'BSD'
						          		|| e.dataItem.title == 'DC'
						          		|| e.dataItem.title == 'UPC'){
							      		selectItemFromChart();
						          	}else{
						          		selectItemFromChartPS();
						          		
						          		$("#divChart1").removeClass("col-sm-11");
						          		$("#divChart1").addClass("col-sm-6");
						          		
						          		$("#divChart2").removeClass("col-sm-1");
						          		$("#divChart2").addClass("col-sm-6");
						          	}
					    }}]
				} );
				
				console.log("canvasGroupJs");
			</h:outputScript>
	</h:panelGroup>
	<h:panelGroup id="canvasGroupPSJs">
		<h:outputScript>
				var chart = AmCharts.makeChart("chartdiv2", {
	    		  "type": "pie",
				  "theme": "light",
				  "dataProvider": #{copDashboardController.chartPS},
				  "labelText": "[[branchType]]",
				  "valueField": "count",
				  "titleField": "branchType",
				  "pullOutDuration": 0,
				  "labelRadius": 5,
				   "balloon":{
				   "fixedPosition":true
				  },
				  "balloonText": "[[branchType]] <br /> Total Shop : [[count]] <br /> Total Amount : [[amountHeader]]",
				  "export": {
				    "enabled": false
				  },
				  "listeners": [{
					    "event": "clickSlice",
					    "method": function(e) {
						    	document.getElementById("formId:x").value = e.dataItem.title;
							    
							    var dp = e.dataItem.dataContext
						      	if ( dp[chart.colorField] === undefined ){
						        	dp[chart.colorField] = "#cc0000";
						        	selectItemFromChart();
						        }
						      	else
						        	dp[chart.colorField] = undefined;
					    }}]
				} );
			</h:outputScript>
	</h:panelGroup>
	<h:panelGroup id="tb_revenueJS">
		<h:outputScript>
				var table = $('#example').DataTable({
				    	  scrollY:        '50vh',
        				  "scrollX": true
				    });
				    
				$('#example').on( 'draw.dt', function () {
						tableNextPage();
					} );
			</h:outputScript>

		<h:panelGroup id="datepickerJs">
			<h:outputScript>	
					$('.toggle-demo').bootstrapToggle({
						on: '',
				      	off: '',
						size: 'small'
				    });
				
					var container=$('.bootstrap-iso form').length>0 ? $('.bootstrap-iso form').parent() : "body";
					$( ".datepicker" ).datepicker({
						format: 'dd/mm/yyyy',
						container: container,
						todayHighlight: true,
						autoclose: true,
					})
				</h:outputScript>
		</h:panelGroup>
	</h:panelGroup>
	
	
	<script type="text/javascript">
		function start() {
			PF('statusDialog').show();
		}
		 
		function stop() {
			PF('statusDialog').hide()
		}
		 
		function divChartClick() {
			document.getElementById("formId:dateStrId").blur();
		}
	</script>
</h:body>
</html>