<?xml version="1.0"?>

<f:view xmlns="http://www.w3.org/1999/xhtml"
        xmlns:f="http://java.sun.com/jsf/core"
        xmlns:h="http://java.sun.com/jsf/html"
        xmlns:p="http://primefaces.org/ui"
        xmlns:ui="http://java.sun.com/jsf/facelets"
        xmlns:c="http://java.sun.com/jsp/jstl/core">
	<h:head>
		  <meta charset="utf-8" />
		  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
		  <title>ERP Dashboard</title>
		  <f:metadata>
			    <f:viewAction action="#{dashboardAction.onload}" />
			</f:metadata>
		  <!-- Tell the browser to be responsive to screen width -->
		  <meta content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" name="viewport" />
		  <link rel="stylesheet" href="../AdminLTE-2.4.3/bower_components/bootstrap/dist/css/bootstrap.min.css" />
		  <link rel="stylesheet" href="../AdminLTE-2.4.3/bower_components/font-awesome/css/font-awesome.min.css" />
		  <link rel="stylesheet" href="../AdminLTE-2.4.3/bower_components/Ionicons/css/ionicons.min.css" />
		  <link rel="stylesheet" href="../AdminLTE-2.4.3/bower_components/jvectormap/jquery-jvectormap.css" />
		  <link rel="stylesheet" href="../AdminLTE-2.4.3/dist/css/AdminLTE.min.css" />
		  <link rel="stylesheet" href="../AdminLTE-2.4.3/dist/css/skins/_all-skins.min.css" />
		   <link href="https://cdn.datatables.net/1.10.16/css/jquery.dataTables.min.css" rel="stylesheet" />
		   
		   <!-- Include Date Range Picker -->
			<script type="text/javascript" src="../js/bootstrap-datepicker.min.js"></script>
			<link rel="stylesheet" href="../css/bootstrap-datepicker3.css"/>
		   
		   <link href="../css/bootstrap-toggle.min.css" rel="stylesheet" />
			<script src="../js/bootstrap-toggle.min.js"></script>
			
			<link rel="stylesheet" href="../css/erp.css" />
			<script type="text/javascript" src="../js/erp.js"></script>
	</h:head>
    <h:body styleClass="skin-blue sidebar-mini sidebar-collapse">
    	<h:form id="formId">
			<div class="wrapper">
			  <header class="main-header">
			    <!-- Logo -->
			    <a href="index2.html" class="logo" style="background-color:#356582">
			      <!-- mini logo for sidebar mini 50x50 pixels -->
			      <span class="logo-mini">ERP</span>
			      <!-- logo for regular state and mobile devices -->
			      <span class="logo-lg"><b>ERP</b></span>
			    </a>
			
			    <!-- Header Navbar: style can be found in header.less -->
			    <nav class="navbar navbar-static-top" style="background-color:#356582">
			      <!-- Sidebar toggle button-->
			      <a href="#" class="sidebar-toggle" data-toggle="push-menu" role="button">
			        <span class="sr-only">Toggle navigation</span>
			      </a>
			      <!-- Navbar Right Menu -->
			      <div class="navbar-custom-menu">
			        <ul class="nav navbar-nav">
			         
			          <!-- User Account: style can be found in dropdown.less -->
			          <li class="dropdown user user-menu">
			            <ul class="dropdown-menu">
			              <li class="user-footer">
			                <div class="pull-left">
			                  <a href="#" class="btn btn-default btn-flat">Profile</a>
			                </div>
			                <div class="pull-right">
			                  <a href="#" class="btn btn-default btn-flat">Sign out</a>
			                </div>
			              </li>
			            </ul>
			          </li>
			          <!-- Control Sidebar Toggle Button -->
			          <li>
			            <h:commandLink styleClass="nav-link" value="Logout"
			       			action="#{dashboardAction.onLogout}">
			       			<i class="fa fa-fw fa-sign-out"></i>
			       		</h:commandLink>
			          </li>
			        </ul>
			      </div>
			
			    </nav>
			  </header>
			  <!-- Left side column. contains the logo and sidebar -->
			  <aside class="main-sidebar">
			    <!-- sidebar: style can be found in sidebar.less -->
			    <section class="sidebar">
			      
			      <!-- sidebar menu: : style can be found in sidebar.less -->
			      <ul class="sidebar-menu" data-widget="tree">
			    
			        <li class="active treeview menu-open">
			          <a href="#">
			            <i class="fa fa-dashboard"></i> <span>Dashboard</span>
			            <span class="pull-right-container">
			              <i class="fa fa-angle-left pull-right"></i>
			            </span>
			          </a>
			          <ul class="treeview-menu">
			            <li class="active"><a href="index2.html"><i class="fa fa-circle-o"></i> Dashboard</a></li>
			          </ul>
			        </li>
			      </ul>
			    </section>
			    <!-- /.sidebar -->
			  </aside>
			
			  <!-- Content Wrapper. Contains page content -->
			  <div class="content-wrapper row-padding">
			    <!-- Content Header (Page header) -->
			    <section class="content-header">
			    	<p:messages id="messages" showDetail="true" closable="true">
		   		 	</p:messages>
			      	<h:outputLabel style="font-size: 24px;" value="Dashboard"></h:outputLabel>
			    </section>
			
			    <!-- Main content -->
			    <section class="content">
			      <div class="row">
			      	<div class="col-md-3">
			      		<div class="box box-default row-padding-min">
			      			
				            <div class="box-body" style="">
				            	<div class="row">
				             		<div class="col-sm-12" >
					             		<h:outputLabel value="Receipt Date: " style="padding-right: 10px;"></h:outputLabel>
				             		</div>
				             	</div>
				             	<div class="row">
				             		<div class="col-sm-12" >
				             			<h:inputText size="10"	
	            								value="#{dashboardAction.dateStr}"
	            								styleClass="form-control datepicker"></h:inputText>
				             		</div>
				             	</div>
				             	<div class="row">
				             		<div class="col-sm-12" style="padding-top: 10px;">
					             		<p:commandButton styleClass="btn btn-primary" style="width:100%" value="View Graph" 
					             			update="canvasGroup, canvasGroupJs, canvasGroupPSJs" 
					             			actionListener="#{dashboardAction.updateReceiptTempChart}"
					             			oncomplete="clearDivChart()" />
				             		</div>
				             	</div>
				             	<div class="row">
				             		<div class="col-sm-12" style="padding-top: 10px;">
					             		<p:commandButton styleClass="btn btn-info" style="width:100%" value="View Accounting" actionListener="#{dashboardAction.showPDF}"
				  							update="pdfId" oncomplete="showModalPDF()" />
				             		</div>
				             	</div>
				            </div>
			      		</div>
			      	</div>
			       <div class="col-md-9">
			        <div class="box box-default row-padding-min">
			            
			            <div class="box-body" style="">
			            	<div class="row pull-right">Last Update: 18/04/2018</div>
			             	<div class="row">
				           		<div class="col-sm-11 text-center" id="divChart1">
				           			<h:panelGroup id="canvasGroup">
										<div id="chartdiv1" class="chartdiv"></div>             
									</h:panelGroup>
				           			
				           		</div>
				           		<div class="col-sm-1 text-center" id="divChart2">
				           			<h:panelGroup id="canvasGroupPS">
										<div id="chartdiv2" class="chartdiv" ></div>  
									</h:panelGroup>
				           		</div>
				           	</div>
			            </div>
			          </div>
			       </div>
			      </div>
			    </section>
			  </div>
			</div>
			
			<div class="modal fade" id="myModal" role="dialog">
			    <div class="modal-dialog modal-lg " style="width: 100%; max-width: 1170px;">
			      <div class="modal-content">
			        <div class="modal-body">
			        	<h:panelGroup id="tb_revenue">
				          <table id="example" class="display" style="width:100%">
								<thead>
								    <tr>
								        <th>ERP ID</th>
							            <th>Branch</th>
							            <th>Receipt Date</th>
							            <th>Amount Header</th>
							            <th>Cash</th>
							            <th>Rabbit</th>
							            <th>Card (BBL)</th>
							            <th>Card (SCB)</th>
							            <th>LinePay</th>
							            <th>Bonus Commission</th>
							            <th>AdjOther</th>
							            <th>Return Charge</th>
							            <th>Suspense</th>
							            <th>With Holding Tax</th>
							            <th>Promotion</th>
							            <th>Insurance</th>
							            <th>Status</th>
								    </tr>
								</thead>
								<tbody>
									<c:forEach var="receipt" items="#{dashboardAction.copReceiptTemps}">
		            					<tr>
		            						
							                <td>#{receipt.shopCode}</td>
								            <td>#{receipt.shopName}</td>
								            <td>
		            							<h:inputText 	
		            								value="#{receipt.arReceiptDateStr}"
		            								styleClass="form-control datepicker"></h:inputText>
		            						</td>
								            <td>#{receipt.amountHeader}</td>
								            <td>#{receipt.cash}</td>
								            <td>#{receipt.rabit}</td>
								            <td>#{receipt.creditBBL}</td>
								            <td>#{receipt.creditSCB}</td>
								            <td>#{receipt.linePay}</td>
								            <td>#{receipt.bonus}</td>
								            <td>#{receipt.adjOther}</td>
								            <td>#{receipt.adjReturnCharge}</td>
								            <td>#{receipt.suspense}</td>
								            <td>#{receipt.withholdingTax}</td>
								            <td>#{receipt.promotion}</td>
								            <td>#{receipt.insurance}</td>
								            <td>
								            	<input class="toggle-demo" type="checkbox" checked="#{receipt.status == 'N' ? '' : 'check'}"
								            		disabled="#{receipt.status == 'N' ? 'disabled' : ''}"
								            		data-toggle="toggle" onchange="statusChange(this, #{receipt.rownum})" 
								            		data-size="small"/>
											</td>
		            					</tr>
	            					</c:forEach>
	            				</tbody>
	            			</table>
	            		</h:panelGroup>
			        </div>
			        <div class="modal-footer">
                    	<button type="button" class="btn btn-primary" onclick="saveReceiptTempJs()">Save</button>
                    		
			          	<h:commandButton value="export excel" 
			          			 styleClass="btn btn-info"
			           			 action="#{dashboardAction.exportTransactionExcel}" />
			           			  
			          	<button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
			        </div>
			      </div>
			    </div>
			  </div>
			  
			  <div class="modal fade" id="myModalPDF" role="dialog">
			    <div class="modal-dialog modal-lg " style="width: 100%; max-width: 1170px;">
			    
			      <!-- Modal content-->
			      <div class="modal-content">
			        <div class="modal-body">
			        	<h:panelGroup id="pdfId">
					          <p:media value="#{dashboardAction.streamedContent}" player="pdf" width="100%" height="550px">
								</p:media>
					 	</h:panelGroup>
					 </div>
			        <div class="modal-footer">
			           <h:commandButton value="export excel" styleClass="btn btn-info" action="#{dashboardAction.exportExcel}" /> 
			        </div>
			      </div>
			      
			    </div>
			  </div>
			
			<h:inputHidden id="x" value="#{dashboardAction.param}" />
			<h:inputHidden id="y" value="#{dashboardAction.param2}" />
			
			<p:remoteCommand name="saveReceiptTempJs" update="canvasGroup, canvasGroupJs, canvasGroupPSJs"
				 action="#{dashboardAction.saveReceiptTemp}"
				 oncomplete="closeModal()" ></p:remoteCommand>
			<p:remoteCommand name="selectItemFromChart" update="tb_revenue, tb_revenueJS"
				 action="#{dashboardAction.updateReceiptTemp}"
				 oncomplete="showModal()" ></p:remoteCommand>
			<p:remoteCommand name="tableNextPage" update="datepickerJs"></p:remoteCommand>
		  	<p:remoteCommand name="selectItemFromChartPS" update="canvasGroupPS canvasGroupPSJs"
				 action="#{dashboardAction.updateChartPS}" ></p:remoteCommand>
			<p:remoteCommand name="updateStatus" action="#{dashboardAction.updateStatus}"></p:remoteCommand>
		</h:form>
		
		<script src="../js/Chart.min.js"></script>
		<script src="//cdn.datatables.net/1.10.16/js/jquery.dataTables.min.js"></script>
		<script src="../js/amcharts.js"></script>
		<script src="../js/pie.js"></script>
		<script src="../js/export.min.js"></script>
		<link rel="stylesheet" href="../css/export.css" type="text/css" media="all" />
		<script src="../js/light.js"></script>
		<script src="../AdminLTE-2.4.3/bower_components/bootstrap/dist/js/bootstrap.min.js"></script>
		<script src="../AdminLTE-2.4.3/bower_components/fastclick/lib/fastclick.js"></script>
		<script src="../AdminLTE-2.4.3/dist/js/adminlte.min.js"></script>
		<script src="../AdminLTE-2.4.3/bower_components/jquery-sparkline/dist/jquery.sparkline.min.js"></script>
		<script src="../AdminLTE-2.4.3/bower_components/jquery-slimscroll/jquery.slimscroll.min.js"></script>
		<script src="../AdminLTE-2.4.3/dist/js/demo.js"></script>
		
		<!-- Chart code -->
		<h:panelGroup id="canvasGroupJs">
			<h:outputScript>
	    		AmCharts.makeChart("chartdiv1", {
	    		  "type": "pie",
				  "theme": "light",
				  "dataProvider": #{dashboardAction.datas},
				  "valueField": "count",
				  "titleField": "branchType",
				  "pullOutDuration": 0,
  				   "pullOutRadius": 0,
				   "balloon":{
				   "fixedPosition":true
				  },
				  "balloonText": "[[branchType]] <br /> Total Shop : [[count]] <br /> Total Amount : [[amountHeader]]",
				  "export": {
				    "enabled": false
				  },
				  "listeners": [{
					    "event": "clickSlice",
					    "method": function(e) {
					    		document.getElementById("formId:x").value = e.dataItem.title;
						    	if(e.dataItem.title == 'BSD'
						          		|| e.dataItem.title == 'DC'
						          		|| e.dataItem.title == 'UPC'){
							      		selectItemFromChart();
						          	}else{
						          		selectItemFromChartPS();
						          		
						          		$("#divChart1").removeClass("col-sm-11");
						          		$("#divChart1").addClass("col-sm-6");
						          		
						          		$("#divChart2").removeClass("col-sm-1");
						          		$("#divChart2").addClass("col-sm-6");
						          	}
					    }}]
				} );
			</h:outputScript>
		</h:panelGroup>
		<h:panelGroup id="canvasGroupPSJs">
			<h:outputScript>
				AmCharts.makeChart("chartdiv2", {
	    		  "type": "pie",
				  "theme": "light",
				  "dataProvider": #{dashboardAction.chartPS},
				  "valueField": "count",
				  "titleField": "branchType",
				  "pullOutDuration": 0,
  				   "pullOutRadius": 0,
				   "balloon":{
				   "fixedPosition":true
				  },
				  "balloonText": "[[branchType]] <br /> Total Shop : [[count]] <br /> Total Amount : [[amountHeader]]",
				  "export": {
				    "enabled": false
				  },
				  "listeners": [{
					    "event": "clickSlice",
					    "method": function(e) {
						    	document.getElementById("formId:x").value = e.dataItem.title;
							    selectItemFromChart();
					    }}]
				} );
			</h:outputScript>
		</h:panelGroup>
		<h:panelGroup id="tb_revenueJS">
			<h:outputScript>
				var table = $('#example').DataTable({
				    	  "scrollX": true
				    });
				    
				$('#example').on( 'page.dt', function () {
						tableNextPage();
					} );
					
				$('#example').on( 'search.dt', function () {
				    tableNextPage();
				} );
			</h:outputScript>
			
			<h:panelGroup id="datepickerJs">
				<h:outputScript>	
					$('.toggle-demo').bootstrapToggle({
				      on: 'Active',
				      off: 'Inacive'
				    });
				
					var container=$('.bootstrap-iso form').length>0 ? $('.bootstrap-iso form').parent() : "body";
					$( ".datepicker" ).datepicker({
						format: 'dd/mm/yyyy',
						container: container,
						todayHighlight: true,
						autoclose: true,
					})
				</h:outputScript>
			</h:panelGroup>
		</h:panelGroup>
    </h:body>
</f:view>
